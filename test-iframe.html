<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test iframe - 3D Grip Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #333;
            border-radius: 8px;
            margin: 20px 0;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .control-group {
            margin: 15px 0;
        }
        .control-group h3 {
            margin-bottom: 10px;
            color: #333;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn-black { background: #2c2c2c; color: white; }
        .btn-sand { background: #d4a574; color: white; }
        .btn-kaki { background: #6b7c3f; color: white; }
        .btn-mlok { background: #4a90e2; color: white; }
        .btn-picatinny { background: #e24a4a; color: white; }
        .btn-viewpoint { background: #9b59b6; color: white; }
        .btn-state { background: #27ae60; color: white; }
        #state-display {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 12px;
        }
        .info {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #4a90e2;
        }
        .info h2 {
            margin-top: 0;
            color: #2c3e50;
        }
        .code {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Test de contr√¥le externe du 3D Grip Viewer</h1>
        
        <div class="info">
            <h2>üìã Comment l'utiliser</h2>
            <p>Cette page d√©montre comment contr√¥ler le viewer 3D depuis un site externe via iframe.</p>
            <p><strong>M√©thode 1 - Console du navigateur :</strong></p>
            <div class="code">// Dans la console de la page de l'iframe directement :
window.gripViewerAPI.setColor('black');
window.gripViewerAPI.setOption('mlok');
window.gripViewerAPI.gotoViewpoint(1);
window.gripViewerAPI.getState();</div>
            
            <p><strong>M√©thode 2 - PostMessage depuis page parent (cette page) :</strong></p>
            <p>Cliquez sur les boutons ci-dessous pour envoyer des commandes √† l'iframe.</p>
        </div>

        <iframe id="viewer-iframe" src="index.html"></iframe>

        <div class="controls">
            <div class="control-group">
                <h3>üé® Changer la couleur</h3>
                <button class="btn-black" onclick="sendCommand('setColor', 'black')">Black</button>
                <button class="btn-sand" onclick="sendCommand('setColor', 'sand')">Sand</button>
                <button class="btn-kaki" onclick="sendCommand('setColor', 'kaki')">Kaki</button>
            </div>

            <div class="control-group">
                <h3>üîß Changer l'option</h3>
                <button class="btn-mlok" onclick="sendCommand('setOption', 'mlok')">M-Lok</button>
                <button class="btn-picatinny" onclick="sendCommand('setOption', 'picatinny')">Picatinny</button>
            </div>

            <div class="control-group">
                <h3>üì∑ Viewpoints</h3>
                <button class="btn-viewpoint" onclick="sendCommand('gotoViewpoint', 1)">Viewpoint 1</button>
                <button class="btn-viewpoint" onclick="sendCommand('gotoViewpoint', 2)">Viewpoint 2</button>
            </div>

            <div class="control-group">
                <h3>üìä √âtat actuel</h3>
                <button class="btn-state" onclick="sendCommand('getState')">Obtenir l'√©tat</button>
                <div id="state-display">Cliquez sur "Obtenir l'√©tat" pour voir l'√©tat actuel du viewer</div>
            </div>
        </div>

        <div class="info" style="margin-top: 20px;">
            <h2>üíª Code JavaScript pour votre site</h2>
            <p>Copiez ce code pour int√©grer et contr√¥ler le viewer sur votre site :</p>
            <div class="code">// HTML
&lt;iframe id="grip-viewer" src="https://votre-domaine.com/index.html"&gt;&lt;/iframe&gt;

// JavaScript
const iframe = document.getElementById('grip-viewer');

// Envoyer une commande
function sendCommandToViewer(action, value) {
    iframe.contentWindow.postMessage({
        action: action,
        color: value,      // pour setColor
        option: value,     // pour setOption
        viewpoint: value   // pour gotoViewpoint
    }, '*'); // En production, remplacez '*' par votre domaine
}

// Exemples d'utilisation
sendCommandToViewer('setColor', 'black');
sendCommandToViewer('setOption', 'mlok');
sendCommandToViewer('gotoViewpoint', 1);

// √âcouter les r√©ponses
window.addEventListener('message', function(event) {
    if (event.data.type === 'gripViewerResponse') {
        console.log('R√©ponse:', event.data);
    }
});</div>
        </div>
    </div>

    <script>
        const iframe = document.getElementById('viewer-iframe');

        // Fonction pour envoyer des commandes √† l'iframe
        function sendCommand(action, value) {
            const message = { action: action };
            
            switch(action) {
                case 'setColor':
                    message.color = value;
                    break;
                case 'setOption':
                    message.option = value;
                    break;
                case 'gotoViewpoint':
                    message.viewpoint = value;
                    break;
                case 'getState':
                    // Pas de valeur suppl√©mentaire
                    break;
            }
            
            console.log('üì§ Envoi de la commande:', message);
            iframe.contentWindow.postMessage(message, '*');
        }

        // √âcouter les r√©ponses de l'iframe
        window.addEventListener('message', function(event) {
            if (event.data.type === 'gripViewerResponse') {
                console.log('üì• R√©ponse re√ßue:', event.data);
                
                // Afficher l'√©tat si demand√©
                if (event.data.action === 'getState' && event.data.result.state) {
                    const stateDisplay = document.getElementById('state-display');
                    stateDisplay.textContent = JSON.stringify(event.data.result.state, null, 2);
                }
                
                // Afficher un message de succ√®s
                if (event.data.result.success) {
                    console.log('‚úÖ Commande ex√©cut√©e avec succ√®s');
                } else {
                    console.warn('‚ö†Ô∏è √âchec de la commande');
                }
            }
        });

        // Attendre que l'iframe soit charg√©e
        iframe.addEventListener('load', function() {
            console.log('‚úÖ Iframe charg√©e et pr√™te');
        });
    </script>
</body>
</html>

